<p>You can train the model at the beginning of your algorithm and you can periodically re-train it as the algorithm executes.</p>

<h4>Warm Up Training Data</h4>
<p>You need historical data to initially train the model at the start of your algorithm. To get the initial training data, in the <code>Initialize</code> method, make a <a href="/docs/v2/writing-algorithms/historical-data/history-requests">history request</a>.</p>
<div class="section-example-container">
    <pre class="python">training_length = 252*2
self.training_data = RollingWindow[float](training_length)
history = self.History[TradeBar](self.symbol, training_length, Resolution.Daily)
for trade_bar in history:
    self.training_data.Add(trade_bar.Close)</pre>
</div>

<h4>Define a Training Method</h4>
<p>To train the model, define a method that fits the model with the training data.</p>
<div class="section-example-container">
    <pre class="python">def get_features_and_labels(self, lookback=5):
    lookback_series = []

    data = pd.Series(list(self.training_data)[::-1])
    for i in range(1, lookback + 1):
        df = data.diff(i)[lookback:-1]
        df.name = f"close-{i}"
        lookback_series.append(df)

    X = pd.concat(lookback_series, axis=1).reset_index(drop=True).dropna()
    Y = data.diff(-1)[lookback:-1].reset_index(drop=True)
    return X.values, Y.values

def my_training_method(self):
    features, labels = self.get_features_and_labels()

    # Define the loss function, we use MSE in this example
    def loss_mse(target_y, predicted_y):
        return tf.reduce_mean(tf.square(target_y - predicted_y))

    # Train the model
    optimizer = tf.keras.optimizers.Adam(learning_rate=self.learning_rate)
    for i in range(self.epochs):
        with tf.GradientTape() as t:
            loss = loss_mse(labels, self.model(features))

        jac = t.gradient(loss, self.model.trainable_weights)
        optimizer.apply_gradients(zip(jac, self.model.trainable_weights))</pre>
</div>

<h4>Set Training Schedule</h4>
<p>To train the model at the beginning of your algorithm, in the <code>Initialize</code> method, call the <code>Train</code> method.</p>
<div class="section-example-container">
    <pre class="python">self.Train(self.my_training_method)</pre>
</div>

<p>To periodically re-train the model as your algorithm executes, in the <code>Initialize</code> method, <a href="/docs/v2/writing-algorithms/machine-learning/training-models#03-Schedule-Training-Sessions">schedule some training sessions</a>.</p>
<div class="section-example-container">
    <pre class="python"># Train the model every Sunday at 8:00 AM
self.Train(self.DateRules.Every(DayOfWeek.Sunday), self.TimeRules.At(8, 0), self.my_training_method)</pre>
</div>

<h4>Update Training Data</h4>
<p>To update the training data as the algorithm executes, in the <code>OnData</code> method, add the current close price to the <code>RollingWindow</code> that holds the training data.</p>
<div class="section-example-container">
    <pre class="python">def OnData(self, slice: Slice) -&gt; None:
    if self.symbol in slice.Bars:
        self.training_data.Add(slice.Bars[self.symbol].Close)</pre>
</div>
