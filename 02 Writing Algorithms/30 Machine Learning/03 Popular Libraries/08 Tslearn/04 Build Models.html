<p>In this example, train a model that clusters the universe of Equities into distinct groups and then allocate an equal portion of the portfolio to each cluster. To cluster the securities, instead of using a real-time comparison, apply Dynamic Time Wrapping Barycenter Averaging (DBA) to their historical prices and then run a k-means clustering algorithm. DBA is a technique of averaging a few time-series into a single one without losing much of their information. Since not all time-series move efficiently like in ideal EMH assumption, this technique allows similarity analysis of different time-series with sticky lags. The following image shows a visualization of the process. For more information about the technical details, see Dynamic Time Warping in the <a href="https://tslearn.readthedocs.io/en/stable/user_guide/dtw.html">tslearn documentation</a>.</p>

<img class="docs-image" src="https://cdn.quantconnect.com/i/tu/dba.png">

<p>To perform DBA and then cluster the securities by k-means, create a TimeSeriesKMeans model:</p>
<div class="section-example-container">
    <pre class="python">self.model = TimeSeriesKMeans(n_clusters=6,   # We have 6 main groups
                    metric="dtw")</pre>
</div>